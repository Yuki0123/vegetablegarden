{% extends 'base.html' %}
{% load tags %}

{% block content %}

<p class="uk-text-large"><i uk-icon="file-edit"></i>最新のお世話記録</p>

<div class="uk-overflow-auto">
    <table class="uk-table uk-table-hover uk-table-middle uk-table-divider uk-table-responsive">
        <tbody>
            {% for cropmanagement in cropmanagements %}

            <tr>
                <td class="uk-text-nowrap uk-text-meta">{{cropmanagement.date|date:"Y-m-d"}}</td>
                <td class=" uk-table-link uk-text-nowrap uk-text-small">
                    <a class="uk-link-reset" href="{% url 'vegetablegarden:cropmanagement_list' cropmanagement.growing_crop.pk %}">
                    {{cropmanagement.growing_crop.vegetable}} - 
                    {{cropmanagement.growing_crop.area}}<br>
                    <span class="uk-text-meta">{{cropmanagement.growing_crop.variety|truncatechars:20}}</span></a>
                </td>
                <td class="uk-table-link uk-text-small">
                    <div class="uk-panel">
                        <a class="uk-link-reset" href="{% url 'vegetablegarden:cropmanagement_list' cropmanagement.growing_crop.pk %}">
                            {{cropmanagement.text|truncatechars:70}}</a>

                        {% if  cropmanagement.image %}
                        <img class="uk-align-right@m uk-margin-remove-adjacent" src="{{ cropmanagement.image.url }}" width="100" alt=""/>
                        {% endif %}
                    </div>
                </td>
            </tr>

            {% endfor %}

        </tbody>
    </table>
</div>

{% regroup growingcrop_list by area as area_list %}
{% for area in area_list %}
<h3><span class="uk-text-background">{{ area.grouper }}</span></h3>

<div class="uk-child-width-1-3@s uk-grid-small" uk-grid>
    {% for growingcrop in area.list %}
    <div>
        <div class="uk-tile uk-tile-muted uk-padding-remove">
            <div class="uk-card uk-card-default uk-height-medium">
                <div class="uk-card-header">
                    <div class="uk-grid-small uk-flex-middle" uk-grid>
                        <div class="uk-width-expand">
                            <p class="uk-margin-remove-bottom">{{growingcrop.vegetable.icon|safe}}{{growingcrop.vegetable}}</p>
                        </div>
                        <div class="uk-width-1-4">
                            <a class="uk-button-text" href="{% url 'vegetablegarden:growingcrop_update' growingcrop.pk %}">
                                <i uk-icon="pencil"></i></a>
                            <a class="uk-button-text" href="{% url 'vegetablegarden:growingcrop_delete' growingcrop.pk %}">
                                <i uk-icon="close"></i></a>
                        </div>
                    </div>
                </div>
                <div class="uk-card-body uk-text-meta">
                    <p class="uk-text-meta uk-margin-remove-top">{{growingcrop.variety|default:""}}</p>
                    <p>
                        {% if growingcrop.seeding_date %}播種日 {{growingcrop.seeding_date|date:"Y-m-d"}} <br>{% endif %}
                        {% if growingcrop.planting_date %}植付日 {{growingcrop.planting_date|date:"Y-m-d"}} <br>{% endif %}
                        {% if growingcrop.transplanting_date %}移植日 {{growingcrop.transplanting_date|date:"Y-m-d"}} <br>{% endif %}
                        {% if growingcrop.harvest_date_start %}収穫開始日 {{growingcrop.harvest_date_start|date:"Y-m-d"}} <br>{% endif %}
                        {% if growingcrop.harvest_date_end %}最終収穫日 {{growingcrop.harvest_date_end|date:"Y-m-d"}} <br>{% endif %}            
                    </p>
                </div>
                <div class="uk-card-footer uk-text-right">
                    <div uk-margin>
                    <a href="{% url 'vegetablegarden:cropmanagement_list' growingcrop.pk %}">
                        <button class="uk-button uk-button-default uk-button uk-width-auto">
                            <i uk-icon="file-edit"></i>お世話記録</button></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endfor %}
{% endblock %}